import"./modulepreload-polyfill-B5Qt9EMX.js";const o=(t,e={},...n)=>{if(t.startsWith("#")||t.startsWith("."))return document.querySelector(t);const c=t==="frag"?document.createDocumentFragment():document.createElement(t);return Object.entries(e||{}).forEach(([s,a])=>{s==="dataset"&&typeof a=="object"?Object.entries(a).forEach(([r,d])=>c.dataset[r]=d):(s==="className"&&Array.isArray(a)&&(a=a.join(" ")),c[s]=a)}),n&&Array.isArray(n)&&n.forEach(s=>{s&&(typeof s=="string"?c.appendChild(document.createTextNode(s)):s instanceof Node&&c.appendChild(s))}),c},p=Object.freeze({QUANTITY_CHANGE:"quantity-change",REMOVE_ITEM:"remove-item"}),i=Object.freeze({CONTAINER:"bg-gray-100 p-8",WRAPPER:"max-w-md mx-auto bg-white rounded-xl shadow-md overflow-hidden md:max-w-2xl p-8",TITLE:"text-2xl font-bold mb-4",CART_ITEMS:"",CART_TOTAL:"text-xl font-bold my-4",PRODUCT_SELECT:"border rounded p-2 mr-2",ADD_TO_CART:"bg-blue-500 text-white px-4 py-2 rounded",STOCK_STATUS:"text-sm text-gray-500 mt-2",NEW_ITEM:"flex justify-between items-center mb-2",QUANTITY_CHANGE:[p.QUANTITY_CHANGE," bg-blue-500 text-white px-2 py-1 rounded mr-1"],REMOVE_ITEM:[p.REMOVE_ITEM,"bg-red-500 text-white px-2 py-1 rounded"],TOTAL_TEXT:"text-green-500 ml-2",LOYALTY_POINTS:"text-blue-500 ml-2"}),y=({id:t,name:e,cost:n})=>o("div",{id:t,className:i.NEW_ITEM},o("span",{textContent:e+" - "+n+"원 x 1"}),o("div",{},o("button",{className:i.QUANTITY_CHANGE,dataset:{productId:t,change:-1},textContent:"-"}),o("button",{className:i.QUANTITY_CHANGE,dataset:{productId:t,change:1},textContent:"+"}),o("button",{className:i.REMOVE_ITEM,dataset:{productId:t},textContent:"삭제"}))),x=10,N=30,C=.25,O=2,h=.1,S=1/1e3,b=5,L=(t=0)=>!t||t<0?null:o("span",{className:i.TOTAL_TEXT,textContent:"("+(t*100).toFixed(1)+"% 할인 적용)"}),g=(t=0)=>{const e=Math.floor(t*S);return o("span",{id:"loyalty-points",className:i.LOYALTY_POINTS,textContent:"(포인트: "+e+")"})},M=(t=0,e=0)=>o("frag",null,"총액: "+Math.round(t)+"원",L(e),g(t)),q=()=>o("div",{className:i.CONTAINER},o("div",{className:i.WRAPPER},o("h1",{className:i.TITLE,textContent:"장바구니"}),o("div",{id:"cart-items"}),o("div",{id:"cart-total",className:i.CART_TOTAL}),o("select",{id:"product-select",className:i.PRODUCT_SELECT}),o("button",{id:"add-to-cart",className:i.ADD_TO_CART,textContent:"추가"}),o("div",{id:"stock-status",className:i.STOCK_STATUS}))),R=t=>o("option",{textContent:`${t.name} - ${t.cost}원`,value:t.id,disabled:t.quantity===0}),D=t=>{const e=o("frag");return t.forEach(n=>{e.appendChild(R(n))}),e},U=t=>{const e=t.filter(n=>n.quantity<b).map(n=>n.name+": "+(n.quantity>0?"재고 부족 ("+n.quantity+"개 남음)":"품절"));return o("frag",null,...e)},P=(t,e)=>{let n=0,c=0,s=0;for(let d=0;d<e.length;d++){const T=t.find(A=>A.id===e[d].id);if(!T)continue;const l=parseInt(e[d].querySelector("span").textContent.split("x ")[1]),u=T.cost*l,m=l>=x&&T.discount?T.discount:0;c+=l,s+=u,n+=u*(1-m)}const a=s-n;let r=a/s;return c>=N&&n*C>a&&(n=s*(1-C),r=C),new Date().getDay()===O&&(n*=1-h,r=Math.max(r,h)),{totalCost:n,discountRate:r}},Y=t=>{const e=o("#stock-status");e&&(e.innerHTML="",e.appendChild(U(t)))},_=t=>{const e=o("#cart-total"),n=o("#cart-items"),{totalCost:c,discountRate:s}=P(t,n.children);e.innerHTML="",e.appendChild(M(c,s)),Y(t)},f=t=>{const e=o("#product-select");e&&(e.innerHTML="",e.appendChild(D(t)))},I="재고가 부족합니다.",v=t=>{const e=o("#product-select"),n=o("#cart-items");if(!e||!n)return null;const c=e.value,s=t.find(r=>r.id===c);if(!s||s.quantity<=0)return alert(I),null;const a=o("#"+s.id);if(a){const r=parseInt(a.querySelector("span").textContent.split("x ")[1])+1;0<=s.quantity?(a.querySelector("span").textContent=s.name+" - "+s.cost+"원 x "+r,s.quantity-=1):alert(I)}else n.appendChild(y({...s})),s.quantity-=1;return c},$=(t,e)=>{const n=t.classList.contains(p.QUANTITY_CHANGE),c=t.classList.contains(p.REMOVE_ITEM);if(!n&&!c)return;const s=t.dataset.productId,a=o("#"+s),r=e.find(u=>u.id===s),d=a.querySelector("span");let[T,l]=d.textContent.split("x ");if(l=parseInt(l),n){const u=parseInt(t.dataset.change),m=l+u;m>0&&m<=r.quantity+l?(d.textContent=T+"x "+m,r.quantity-=u):m<=0?(a.remove(),r.quantity-=u):alert(I)}else if(c){const u=l;r.quantity+=u,a.remove()}},w=()=>{const t=o("#add-to-cart"),e=o("#cart-items"),n=()=>{const{products:s,lastSelected:a}=globalThis;globalThis.lastSelected=v(s)||a,_(s)},c=s=>{const{products:a}=globalThis;$(s.target,a),_(a)};t.addEventListener("click",n),e.addEventListener("click",c)},k=()=>{setTimeout(()=>{setInterval(()=>{const{products:t}=globalThis,e=t[Math.floor(Math.random()*t.length)];Math.random()<.3&&e.quantity>0&&(e.cost=Math.round(e.cost*.8),alert("번개세일! "+e.name+"이(가) 20% 할인 중입니다!"),f(t))},3e4)},Math.random()*1e4),setTimeout(()=>{setInterval(()=>{const{products:t,lastSelected:e}=globalThis;if(!e)return;const n=t.find(c=>c.id!==e&&c.quantity>0);n&&(alert(n.name+"은(는) 어떠세요? 지금 구매하시면 5% 추가 할인!"),n.cost=Math.round(n.cost*.95),f(t))},6e4)},Math.random()*2e4)},E=[{id:"p1",name:"상품1",cost:1e4,quantity:50,discount:.1},{id:"p2",name:"상품2",cost:2e4,quantity:30,discount:.15},{id:"p3",name:"상품3",cost:3e4,quantity:20,discount:.2},{id:"p4",name:"상품4",cost:15e3,quantity:0,discount:.05},{id:"p5",name:"상품5",cost:25e3,quantity:10,discount:.25}],Q=()=>{globalThis.products=E,globalThis.lastSelected=void 0,o("#app").appendChild(q()),f(E),_(E),k(),w()};Q();
